负载均衡分别作用域生产者和消费者，下面对这两种情况分别分析。


## 生产者
对于生产者中的负载均衡，

根据笔记[如何实现消息发送](如何实现消息发送.md)可知，发送消息过程中调用的`DefaultMQProducerImpl`类的`sendDefaultImpl()`方法在获取到路由信息后，需要选择一个队列发送消息，选择过程在`DefaultMQProducerImpl`类的`selectOneMessageQueue()`方法，代码如下：
```java
public MessageQueue selectOneMessageQueue(final TopicPublishInfo tpInfo, final String lastBrokerName) {
    return this.mqFaultStrategy.selectOneMessageQueue(tpInfo, lastBrokerName);
}
```

真正调用的是`MQFaultStrategy`类的`selectOneMessageQueue()`方法，